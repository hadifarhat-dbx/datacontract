dataContractSpecification: 1.2.0
id: orders-latest-min
info:
  title: Orders Latest (Minimal)
  version: 0.1.0

servers:
  production:
    type: databricks
    catalog: DATAC
    schema: orders

models:
  orders_raw:                # ← matches your table/view name
    type: table
    description: One record per order.
    fields:
      order_id:
        type: text
        required: true
        unique: true
        primaryKey: true
      order_timestamp:
        type: timestamp
        required: true
      order_total:
        type: long
        required: true

    # Keep only two simple, Spark/Databricks-safe checks
    quality:
      - type: sql
        description: Row count should be > 2.
        query: |
          SELECT COUNT(*) AS row_count
          FROM orders_raw
        mustBeGreaterThan: 2 #no

      - type: sql
        description: p95(order_total) should be between €10 and €499 (in cents).
        # Use Spark/Databricks-compatible percentile function
        query: |
          SELECT percentile_approx(order_total, 0.95) AS p95
          FROM orders_raw
        mustBeBetween: [1000, 49900]
